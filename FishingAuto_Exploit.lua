-- FishingAuto_Exploit.lua
-- Exploit-friendly script untuk Delta/Synapse-like. Gunakan dengan tanggung jawab.
-- Menyertakan activation key (GUI + chat). REQUIRED_KEY="" untuk non-aktif.

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- ======= CONFIG =======
local REQUIRED_KEY = "wilzuvTx7899"    -- isi key; kosongkan "" untuk menonaktifkan mekanisme key
local BOBBER_NAME_PATTERNS = {"bobber", "float"}
local SEARCH_RADIUS = 80
local VEL_THRESHOLD = -1.2
local MIN_DIP_DURATION = 0.06
local PROMPT_DURATION = 3
local CONFIRM_KEY = Enum.KeyCode.W
local AUTO_CLICK_ON_CONFIRM = true    -- klik otomatis ketika user tekan CONFIRM_KEY
local AUTO_CATCH_NO_PROMPT = false    -- langsung auto-catch tanpa menunggu konfirmasi
-- =======================

-- minimal UI untuk key (hanya muncul jika REQUIRED_KEY != "")
local screenGui
local keyFrame, keyBox
local keyValid = (REQUIRED_KEY == "")
if REQUIRED_KEY ~= "" then
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FishingAutoExploitGui"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    keyFrame = Instance.new("Frame")
    keyFrame.Size = UDim2.new(0, 360, 0, 48)
    keyFrame.Position = UDim2.new(0.5, -180, 0.05, 0)
    keyFrame.BackgroundTransparency = 0.25
    keyFrame.Parent = screenGui

    keyBox = Instance.new("TextBox")
    keyBox.Size = UDim2.new(1, -10, 1, -10)
    keyBox.Position = UDim2.new(0, 5, 0, 5)
    keyBox.ClearTextOnFocus = false
    keyBox.PlaceholderText = "Masukkan key untuk mengaktifkan script exploit"
    keyBox.Text = ""
    keyBox.Parent = keyFrame
end

-- chat command /setkey
player.Chatted:Connect(function(msg)
    if REQUIRED_KEY == "" then return end
    local prefix, arg = msg:match("^(%S+)%s*(.*)")
    if prefix and prefix:lower() == "/setkey" then
        if arg == REQUIRED_KEY then
            keyValid = true
            if keyFrame and keyFrame.Parent then keyFrame:Destroy() end
            warn("Key benar via chat. FishingAuto (exploit) diaktifkan.")
        else
            warn("Key chat salah.")
        end
    end
end)

if keyBox then
    keyBox.FocusLost:Connect(function(enterPressed)
        if REQUIRED_KEY == "" then return end
        if keyBox.Text == REQUIRED_KEY then
            keyValid = true
            keyFrame:Destroy()
            warn("Key benar — FishingAuto (exploit) diaktifkan.")
        else
            keyBox.Text = ""
            warn("Key salah.")
        end
    end)
end

local function nameMatches(name)
    if not name then return false end
    local n = name:lower()
    for _, pat in ipairs(BOBBER_NAME_PATTERNS) do
        if n:find(pat) then return true end
    end
    return false
end

local function findBobber()
    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not root then return nil end
    local best, bestDist = nil, math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and nameMatches(obj.Name) then
            local ok, pos = pcall(function() return obj.Position end)
            if ok then
                local d = (pos - root.Position).Magnitude
                if d < bestDist and d <= SEARCH_RADIUS then
                    bestDist = d
                    best = obj
                end
            end
        end
    end
    return best
end

-- klik pakai VirtualUser (bisa diganti sesuai exploit kalau perlu)
local function doVirtualClick()
    pcall(function()
        local success, vu = pcall(function() return game:GetService("VirtualUser") end)
        if success and vu then
            vu:CaptureController()
            if vu.ClickButton1 then
                local ok = pcall(function() vu:ClickButton1(Vector2.new(0,0)) end)
                if not ok then
                    pcall(function() vu:ClickButton1() end)
                end
            end
        else
            if _G.mouse1click then
                pcall(_G.mouse1click)
            end
        end
    end)
end

local function monitor(bobber)
    if not bobber then return end
    local lastY = bobber.Position.Y
    local dipStart = nil
    local conn
    conn = RunService.RenderStepped:Connect(function(dt)
        if not bobber or not bobber.Parent then conn:Disconnect(); return end
        local curY = bobber.Position.Y
        local vy = (curY - lastY) / dt
        lastY = curY

        if vy <= VEL_THRESHOLD then
            if not dipStart then dipStart = tick() end
            if tick() - dipStart >= MIN_DIP_DURATION then
                conn:Disconnect()

                if not keyValid then
                    warn("Ikan terdeteksi tapi script belum diaktifkan (masukkan key).")
                    return
                end

                if AUTO_CATCH_NO_PROMPT then
                    doVirtualClick()
                    warn("Auto-catch (no prompt) triggered.")
                    return
                end

                warn("Ikan terdeteksi! Tekan '"..CONFIRM_KEY.Name.."' untuk konfirmasi.")
                local confirmed = false
                local started = tick()
                local inputConn
                inputConn = UserInputService.InputBegan:Connect(function(input, processed)
                    if processed then return end
                    if input.KeyCode == CONFIRM_KEY then confirmed = true end
                end)

                while tick() - started < PROMPT_DURATION and not confirmed do
                    RunService.RenderStepped:Wait()
                end
                inputConn:Disconnect()

                if confirmed then
                    if AUTO_CLICK_ON_CONFIRM then doVirtualClick() end
                    warn("Konfirmasi diterima — klik dikirim.")
                else
                    warn("Tidak ada konfirmasi.")
                end

                wait(0.25)
                if bobber and bobber.Parent then monitor(bobber) end
                return
            end
        else
            dipStart = nil
        end
    end)
end

-- main loop
spawn(function()
    while true do
        local b = findBobber()
        if b then
            monitor(b)
            wait(0.3)
            repeat wait(0.25) until not (b and b.Parent)
        else
            wait(0.8)
        end
    end
end)
